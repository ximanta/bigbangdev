import React, { useState, useEffect } from 'react';import { useParams, useNavigate } from 'react-router-dom';import { usePlants } from '../context/PlantContext.jsx';import TabBar from '../components/TabBar.jsx';import Button from '../components/Button.jsx';import InputField from '../components/InputField.jsx';import DropdownSelector from '../components/DropdownSelector.jsx';import PlantHealthIndicator from '../components/PlantHealthIndicator.jsx';import ImageUploader from '../components/ImageUploader.jsx';import Card from '../components/Card.jsx';import { useToast } from '../context/ToastContext.jsx';const PlantDetailsTab = ({ plant, onUpdatePlant }) => {const [editMode, setEditMode] = useState(false);const [editedName, setEditedName] = useState(plant.name);const [editedType, setEditedType] = useState(plant.type);const [editedHealthStatus, setEditedHealthStatus] = useState(plant.healthStatus);const [editedImage, setEditedImage] = useState(plant.image);const { showToast } = useToast();const healthOptions = [{value:'healthy',label:'Healthy'},{value:'needs_attention',label:'Needs Attention'},{value:'critical',label:'Critical'}];const plantTypeOptions = [{value:'Flower',label:'Flower'},{value:'Vegetable',label:'Vegetable'},{value:'Herb',label:'Herb'},{value:'Tree',label:'Tree'},{value:'Shrub',label:'Shrub'},{value:'Succulent',label:'Succulent'},{value:'Other',label:'Other'}];const handleSave = () => {onUpdatePlant({...plant,name:editedName,type:editedType,healthStatus:editedHealthStatus,image:editedImage});setEditMode(false);showToast('Plant details updated!', 'success');};const detailItemStyle = {marginBottom:'10px'};const labelStyle = {fontWeight:'bold',marginRight:'5px',color:'#555'};return(<div style={{padding:'16px'}}><ImageUploader onImageUpload={setEditedImage} currentImage={editedImage} /><div style={detailItemStyle}><span style={labelStyle}>Name:</span>{editMode ? (<InputField value={editedName} onChange={(e) => setEditedName(e.target.value)} />) : (<span>{plant.name}</span>)}</div><div style={detailItemStyle}><span style={labelStyle}>Type:</span>{editMode ? (<DropdownSelector options={plantTypeOptions} value={editedType} onChange={(e) => setEditedType(e.target.value)} />) : (<span>{plant.type}</span>)}</div><div style={detailItemStyle}><span style={labelStyle}>Health Status:</span>{editMode ? (<DropdownSelector options={healthOptions} value={editedHealthStatus} onChange={(e) => setEditedHealthStatus(e.target.value)} />) : (<PlantHealthIndicator healthStatus={plant.healthStatus} />)}</div>{!editMode ? (<Button onClick={() => setEditMode(true)} style={{marginTop:'15px'}}>Edit Details</Button>) : (<div style={{display:'flex',gap:'10px',marginTop:'15px'}}><Button onClick={handleSave}>Save Changes</Button><Button variant="secondary" onClick={() => {setEditMode(false);setEditedName(plant.name);setEditedType(plant.type);setEditedHealthStatus(plant.healthStatus);setEditedImage(plant.image);}}>Cancel</Button></div>)}</div>);};const CareLogTab = ({ plant, onUpdatePlant }) => {const [activity, setActivity] = useState('');const [date, setDate] = useState('');const [notes, setNotes] = useState('');const { showToast } = useToast();const addLogEntry = () => {if (activity && date) {const newLog = {id: Date.now().toString(),activity,date,notes};const updatedPlant = {...plant,careLog:[...(plant.careLog || []), newLog]};onUpdatePlant(updatedPlant);setActivity('');setDate('');setNotes('');showToast('Care log entry added!', 'success');}};const deleteLogEntry = (logId) => {const updatedPlant = {...plant,careLog:plant.careLog.filter(log => log.id !== logId)};onUpdatePlant(updatedPlant);showToast('Log entry deleted.', 'info');};const logEntryStyle = {display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'8px',padding:'10px',backgroundColor:'#f9f9f9',borderRadius:'4px',border:'1px solid #eee'};const logTextStyle = {flexGrow:1};const logTitleStyle = {fontWeight:'bold',fontSize:'1em'};const logDetailStyle = {fontSize:'0.85em',color:'#666'};const deleteButtonStyle = {backgroundColor:'#f44336',color:'white',border:'none',borderRadius:'4px',padding:'5px 10px',cursor:'pointer',fontSize:'0.8em'};return(<div style={{padding:'16px'}}><h3 style={{color:'#333',marginBottom:'15px'}}>Add New Care Log Entry</h3><InputField label="Activity" value={activity} onChange={(e) => setActivity(e.target.value)} placeholder="e.g., Watered, Fertilized" /><InputField label="Date" type="date" value={date} onChange={(e) => setDate(e.target.value)} /><InputField label="Notes" value={notes} onChange={(e) => setNotes(e.target.value)} placeholder="Optional notes" /><Button onClick={addLogEntry} disabled={!activity || !date} style={{width:'100%',marginBottom:'20px'}}>Add Log Entry</Button><h3 style={{color:'#333',marginBottom:'15px'}}>Care History</h3>{(plant.careLog && plant.careLog.length > 0) ? ([...plant.careLog].sort((a, b) => new Date(b.date) - new Date(a.date)).map((log) => (<Card key={log.id} style={logEntryStyle}><div style={logTextStyle}><div style={logTitleStyle}>{log.activity} on {log.date}</div><div style={logDetailStyle}>{log.notes}</div></div><Button onClick={() => deleteLogEntry(log.id)} style={deleteButtonStyle}>Delete</Button></Card>))) : (<div className="no-items-message">No care log entries yet.</div>)}</div>);};const PlantDetailPage = () => {const { id } = useParams();const navigate = useNavigate();const { plants, updatePlant, deletePlant } = usePlants();const { showToast } = useToast();const [currentTab, setCurrentTab] = useState('details');const plant = plants.find((p) => p.id === id);useEffect(() => {if (!plant) {navigate('/my-garden');showToast('Plant not found!', 'error');}}, [plant, navigate, showToast]);if (!plant) {return null;}const tabs = [{label:'Details',path:'details'},{label:'Care Log',path:'care-log'}];const handleDeletePlant = () => {if (window.confirm(`Are you sure you want to delete ${plant.name}?`)) {deletePlant(plant.id);showToast('Plant deleted successfully!', 'success');navigate('/my-garden');}};const handleUpdatePlant = (updatedPlant) => {updatePlant(updatedPlant);};const pageStyle = {padding:'20px',maxWidth:'800px',margin:'0 auto'};const plantImageStyle = {width:'100%',height:'200px',objectFit:'cover',borderRadius:'8px',marginBottom:'15px'};const plantNameStyle = {fontSize:'1.8em',fontWeight:'bold',color:'#333',marginBottom:'10px'};const deleteButtonStyle = {backgroundColor:'#f44336',color:'white',border:'none',borderRadius:'4px',padding:'10px 15px',cursor:'pointer',fontSize:'1em',marginTop:'20px'};return(<div className="container"><Button onClick={() => navigate('/my-garden')} variant="secondary" style={{marginBottom:'15px'}}>&larr; Back to My Garden</Button>{plant.image && (<img src={plant.image} alt={plant.name} style={plantImageStyle} />)}<h1 style={plantNameStyle}>{plant.name}</h1><TabBar tabs={tabs} baseUrl={`/plant/${plant.id}`} /><div style={{backgroundColor:'white',borderRadius:'8px',boxShadow:'0 2px 4px rgba(0,0,0,0.1)',marginBottom:'16px'}}>{currentTab === 'details' && (<PlantDetailsTab plant={plant} onUpdatePlant={handleUpdatePlant} />)}{currentTab === 'care-log' && (<CareLogTab plant={plant} onUpdatePlant={handleUpdatePlant} />)}</div><Button onClick={handleDeletePlant} style={deleteButtonStyle}>Delete Plant</Button></div>);};export default PlantDetailPage;